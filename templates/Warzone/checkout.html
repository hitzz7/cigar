{% extends './navbar.html' %}
{% load static %}

{% block title %}Checkout{% endblock %}

{% block content %}
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #f0f4f8;
    margin: 0;
    padding: 0;
  }

  .checkout-section {
    padding: 50px 20px;
    margin-top: 50px;
    background-color: #f9f9f9;
  }

  .checkout-container {
    display: flex;
    flex-wrap: wrap;
    width: 70%;
    margin: 0 auto;
    gap: 30px;
  }

  /* Form Styles */
  .form-container {
    flex: 1;
    background: #ffffff;
    padding: 30px;
    font-family: "urban", sans-serif;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.05);
    min-width: 400px;
  }

  .form-container h3 {
    margin-bottom: 20px;
    font-size: 26px;
    font-weight: 700;
    color: #444;
  }

  .form-group {
    margin-bottom: 20px;
  }

  .form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    font-size: 18px;
  }

  .form-group input,
  .form-group select,
  .form-group textarea {
    width: 90%;
    padding: 12px;
    font-size: 16px;
    border: 1px solid #ddd;
    border-radius: 0px;
    background: #fafafa;
    transition: 0.3s ease;
  }

  .form-group input:focus,
  .form-group select:focus,
  .form-group textarea:focus {
    border-color: #0097b2;
    box-shadow: 0 0 5px rgba(0, 151, 178, 0.3);
    outline: none;
  }

  .submit-button {
    font-size: 20px;
    padding: 12px;
    background-color: #D0FF71;
    color: black;
    font-weight: bold;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-family: 'supercharge', sans-serif;
    transition: background-color 0.3s ease;
    width: 100%;
    margin-top: 30px;
  }

  .submit-button:hover {
    background-color: black;
    color: white;
  }

  /* Order Summary Styles */
  .order-summary {
    flex: 1;
    background-color: #ffffff;
    padding: 30px;
    border-radius: 0px;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.05);
    max-width: 400px;
    max-height: 600px;
    overflow-y: auto;
  }

  .order-summary h3 {
    font-size: 26px;
    font-weight: 700;
    margin-bottom: 20px;
    font-family: 'valo', sans-serif;
  }

  .order-summary ul {
    list-style: none;
    padding: 0;
    font-size: 16px;
  }

  .order-summary li {
    display: flex;
    gap: 15px;
    align-items: center;
    font-size: 16px;
    border-bottom: 1px solid #eee;
    padding: 15px 0;
  }

  .item-image img {
    width: 80px;
    height: auto;
    object-fit: cover;
    border-radius: 6px;
  }

  .total-price {
    font-size: 22px;
    font-weight: bold;
    margin-top: 20px;
    font-family: "urban", sans-serif;
  }

  @media (max-width: 768px) {
    .checkout-container {
      flex-direction: column;
    }
  }

  /* Payment Option */
  .payment-option-group {
    display: flex;
    gap: 20px;
    margin-top: 20px;
  }

  .payment-option {
    border: 2px solid #ccc;
    padding: 20px;
    border-radius: 6px;
    background-color: #fdfdfd;
    cursor: pointer;
    flex: 1;
    transition: all 0.3s ease;
    text-align: center;
  }

  .payment-option.selected {
    border-color: #0097b2;
    background-color: #e6f9fd;
    box-shadow: 0 0 0 2px #0097b2 inset;
  }

  .payment-option p {
    margin: 10px 0 0;
    font-size: 14px;
    color: #555;
  }
   @media (max-width: 1024px) {
    .checkout-container {
      width: 90%;
      gap: 20px;
    }

    .form-container, .order-summary {
      min-width: 300px;
    }
  }

  @media (max-width: 768px) {
    .checkout-container {
      flex-direction: column;
    }

    .order-summary {
      max-width: 100%;
      max-height: none;
    }
  }

  @media (max-width: 480px) {
    .checkout-section {
      padding: 30px 15px;
    }

    .form-container, .order-summary {
      padding: 20px;
    }

    .form-container h3, .order-summary h3 {
      font-size: 22px;
    }

    .form-group label {
      font-size: 16px;
    }

    .submit-button {
      font-size: 18px;
      padding: 10px;
    }

    .payment-option {
      padding: 15px;
      font-size: 14px;
    }

    .item-image img {
      width: 60px;
    }

    .total-price {
      font-size: 20px;
    }
  }
</style>

<div class="checkout-section">
  <h2 style="text-align: center; font-size: 50px; font-weight: 700; margin-bottom: 40px;">Checkout</h2>
  <form method="POST">
    {% csrf_token %}
    <div class="checkout-container">

      <!-- Left Side: Form -->
      <div class="form-container">
        <h3>Contact Information</h3>
        <div class="form-group">
          <label for="name">Full Name</label>
          <input type="text" name="name" id="name" required>
        </div>

        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" name="email" id="email" required>
        </div>

        <div class="form-group">
          <label for="phone">Phone</label>
          <input type="text" name="phone" id="phone" required>
        </div>

        <h3 style="margin-top: 40px;">Shipping Address</h3>
        <div class="form-group">
          <label for="address">Address</label>
          <textarea name="address" id="address" required></textarea>
        </div>

        <div class="form-group">
          <label for="city">City</label>
          <select name="city" id="id_city" required>
            <option value="">Select City</option>
            {% for city in cities %}
              <option value="{{ city.id }}">{{ city.name }} - Rs {{ city.delivery_charge }}</option>
            {% endfor %}
          </select>
        </div>

        <div class="form-group">
          <label for="landmark">Landmark (Optional)</label>
          <textarea name="landmark" id="landmark"></textarea>
        </div>

        <h3 style="margin-top: 40px;">Payment Method</h3>
        <div class="payment-option-group">
          <input type="hidden" name="payment_method" id="paymentMethodInput" value="cod">
          <div class="payment-option selected" data-value="cod">
            <strong>Cash on Delivery (COD)</strong>
            <p>Pay with cash when your order is delivered.</p>
          </div>
        </div>

        <button type="submit" class="submit-button">Place Order</button>
      </div>

      <!-- Right Side: Order Summary -->
      <div class="order-summary">
        <h3>Your Cart</h3>
        <ul>
          {% for item in cart_items %}
          <li>
            <div class="item-image">
              {% if item.feature_image %}
                <img src="{{ item.feature_image }}" alt="{{ item.product.name }}">
              {% endif %}
            </div>
            <div>
              <strong>{{ item.product.title }}</strong><br>
              Ã— {{ item.quantity }}<br>
              {% if item.variant %}
            <span style="font-size: 14px; color: #555;">({{ item.variant.name }})</span>
          {% endif %}
              Rs {{ item.subtotal|floatformat:2 }}
            </div>
          </li>
          {% endfor %}
        </ul>
        <p id="delivery-charge" class="total-price">Delivery: Rs 0.00</p>
        <p id="total-price" class="total-price" data-base-total="{{ total_price|floatformat:2 }}">
          Total: Rs {{ total_price|floatformat:2 }}
        </p>
      </div>

    </div>
  </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const cityDropdown = document.getElementById('id_city');
    const deliveryChargeEl = document.getElementById('delivery-charge');
    const totalPriceEl = document.getElementById('total-price');

    let baseTotal = parseFloat(totalPriceEl.dataset.baseTotal);

    cityDropdown.addEventListener('change', function() {
        const cityId = this.value;
        if (cityId) {
            fetch("{% url 'store:get_delivery_charge' %}?city_id=" + cityId)
                .then(res => res.json())
                .then(data => {
                    const charge = parseFloat(data.delivery_charge) || 0;
                    deliveryChargeEl.textContent = `Delivery: Rs ${charge.toFixed(2)}`;
                    totalPriceEl.textContent = `Total: Rs ${(baseTotal + charge).toFixed(2)}`;
                })
                .catch(err => console.error(err));
        } else {
            deliveryChargeEl.textContent = `Delivery: Rs 0.00`;
            totalPriceEl.textContent = `Total: Rs ${baseTotal.toFixed(2)}`;
        }
    });
});
</script>



{% endblock %}
